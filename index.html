<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Soul: The Last Whisper</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; color: #fff; touch-action: none; }
        #ui { position: absolute; top: 30px; width: 100%; display: flex; justify-content: space-around; z-index: 10; pointer-events: none; }
        .stat { text-align: center; letter-spacing: 4px; font-size: 10px; color: #fff; opacity: 0.6; }
        .val { font-size: 20px; font-weight: bold; color: #4fc3f7; display: block; margin-top: 5px; }
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; cursor: pointer; }
        #game-over { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 50; }
        canvas { display: block; filter: blur(0.5px); }
        h1 { font-size: 24px; font-weight: lighter; letter-spacing: 15px; }
    </style>
</head>
<body>

<div id="start-screen">
    <h1>R-SOUL</h1>
    <p style="opacity: 0.4;">FIND THE LIGHT IN THE VOID</p>
</div>

<div id="ui">
    <div class="stat">ESSENCE<span id="score" class="val">0</span></div>
    <div class="stat">SOUL ENERGY<span id="energy" class="val">100</span></div>
</div>

<div id="game-over">
    <h1 style="color:#555;">FADED INTO DARKNESS</h1>
    <button onclick="location.reload()" style="background:none; border:1px solid #4fc3f7; color:#4fc3f7; padding:10px 30px; cursor:pointer; margin-top:20px;">REAWAKEN</button>
</div>

<canvas id="soulCanvas"></canvas>

<script>
const canvas = document.getElementById('soulCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0, energy = 100, gameActive = false;
let particles = [], shadows = [];
let audioCtx;

function initAudio() {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    // Ambient Background Drone
    const createDrone = (freq, vol) => {
        const osc = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        g.gain.setValueAtTime(vol, audioCtx.currentTime);
        osc.connect(g).connect(audioCtx.destination);
        osc.start();
    };
    createDrone(55, 0.05); // A1 Deep Base
    createDrone(110, 0.02); // A2 Middle
}

function playSoulEcho(f) {
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.setValueAtTime(f, audioCtx.currentTime);
    g.gain.setValueAtTime(0.05, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 2);
    o.connect(g).connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + 2);
}

const soul = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    r: 8,
    draw() {
        const grad = ctx.createRadialGradient(this.x, this.y, 2, this.x, this.y, 20);
        grad.addColorStop(0, '#fff');
        grad.addColorStop(1, 'rgba(79, 195, 247, 0)');
        ctx.fillStyle = grad;
        ctx.beginPath(); ctx.arc(this.x, this.y, 20, 0, 7); ctx.fill();
    }
};

class Shadow {
    constructor() {
        this.angle = Math.random() * Math.PI * 2;
        this.dist = canvas.width;
        this.speed = 1.5;
        this.x = soul.x + Math.cos(this.angle) * this.dist;
        this.y = soul.y + Math.sin(this.angle) * this.dist;
    }
    update() {
        const dx = soul.x - this.x;
        const dy = soul.y - this.y;
        const d = Math.sqrt(dx*dx + dy*dy);
        this.x += (dx / d) * this.speed;
        this.y += (dy / d) * this.speed;

        if (d < 20) {
            energy -= 10;
            playSoulEcho(100);
            return false;
        }
        return true;
    }
    draw() {
        ctx.fillStyle = 'rgba(255, 255, 255, 0.05)';
        ctx.beginPath(); ctx.arc(this.x, this.y, 15, 0, 7); ctx.fill();
    }
}

class Essence {
    constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
    }
    draw() {
        ctx.fillStyle = '#4fc3f7';
        ctx.shadowBlur = 10; ctx.shadowColor = '#4fc3f7';
        ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, 7); ctx.fill();
        ctx.shadowBlur = 0;
    }
}

let targetEssence = new Essence();

function loop() {
    if (!gameActive) return;
    ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    soul.draw();
    targetEssence.draw();

    if (Math.random() < 0.02) shadows.push(new Shadow());

    shadows = shadows.filter(s => {
        const active = s.update();
        if (active) s.draw();
        return active;
    });

    const distToEssence = Math.sqrt((soul.x - targetEssence.x)**2 + (soul.y - targetEssence.y)**2);
    if (distToEssence < 30) {
        score += 1;
        energy = Math.min(100, energy + 5);
        targetEssence = new Essence();
        playSoulEcho(440 + (score * 10));
    }

    document.getElementById('score').innerText = score;
    document.getElementById('energy').innerText = Math.floor(energy);

    if (energy <= 0) {
        gameActive = false;
        document.getElementById('game-over').style.display = 'flex';
    }

    requestAnimationFrame(loop);
}

document.getElementById('start-screen').addEventListener('click', () => {
    document.getElementById('start-screen').style.display = 'none';
    initAudio();
    gameActive = true;
    loop();
});

window.addEventListener('pointermove', e => {
    soul.x = e.clientX;
    soul.y = e.clientY;
});
</script>
</body>
</html>